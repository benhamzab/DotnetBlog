@model BLOGAURA.Models.Posts.ProfileViewModel
@{
    ViewData["Title"] = "Profil";
    var userName = Model.User.UserName ?? "Utilisateur";
    var email = Model.User.Email ?? "";
    var initial = string.IsNullOrWhiteSpace(userName) ? "U" : userName.Trim()[0].ToString().ToUpperInvariant();
    var joinDate = Model.User.CreatedAt.ToString("MMMM yyyy");
    var postsCount = Model.Posts?.Count() ?? 0;
}

<style>
    /* Profile Page Styles */
    .profile-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0;
    }

    /* Hero Header */
    .profile-hero {
        position: relative;
        height: 280px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 0 0 24px 24px;
        overflow: hidden;
    }

    .profile-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
    }

    .profile-edit-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 10px 20px;
        border-radius: 12px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .profile-edit-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    /* Avatar Section */
    .profile-avatar-section {
        position: relative;
        margin-top: -80px;
        padding: 0 40px;
        margin-bottom: 30px;
    }

    .profile-avatar-wrapper {
        position: relative;
        width: 160px;
        height: 160px;
        margin: 0 auto;
    }

    .profile-avatar {
        width: 160px;
        height: 160px;
        border-radius: 50%;
        border: 6px solid white;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 64px;
        font-weight: 700;
        color: white;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease;
        object-fit: cover;
    }

    .profile-avatar:hover {
        transform: scale(1.05);
    }

    .profile-info {
        text-align: center;
        margin-top: 20px;
    }

    .profile-name {
        font-size: 32px;
        font-weight: 700;
        color: #1a202c;
        margin-bottom: 5px;
    }

    .profile-username {
        font-size: 18px;
        color: #718096;
        margin-bottom: 15px;
    }

    .profile-bio {
        font-size: 16px;
        color: #4a5568;
        max-width: 600px;
        margin: 0 auto 25px;
        line-height: 1.6;
    }

    /* Stats */
    .profile-stats {
        display: flex;
        justify-content: center;
        gap: 30px;
        flex-wrap: wrap;
        margin-bottom: 40px;
    }

    .profile-stat {
        background: white;
        padding: 15px 25px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
        min-width: 120px;
        transition: all 0.3s ease;
    }

    .profile-stat:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }

    .profile-stat-value {
        font-size: 24px;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 5px;
    }

    .profile-stat-label {
        font-size: 14px;
        color: #718096;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Tabs */
    .profile-tabs {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 30px;
        border-bottom: 2px solid #e2e8f0;
        padding: 0 40px;
    }

    .profile-tab {
        padding: 15px 30px;
        background: none;
        border: none;
        color: #718096;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        position: relative;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .profile-tab:hover {
        color: #667eea;
    }

    .profile-tab.active {
        color: #667eea;
    }

    .profile-tab.active::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 3px 3px 0 0;
    }

    /* Tab Content */
    .profile-tab-content {
        display: none;
        padding: 0 40px 40px;
    }

    .profile-tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @@keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Posts Grid */
    .profile-posts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }

    /* About Section */
    .profile-about {
        max-width: 800px;
        margin: 0 auto;
    }

    .profile-about-section {
        background: white;
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }

    .profile-about-section h3 {
        font-size: 20px;
        font-weight: 700;
        color: #1a202c;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .profile-tech-stack {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .profile-tech-badge {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
    }

    .profile-links {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }

    .profile-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        background: #f7fafc;
        border-radius: 10px;
        color: #4a5568;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .profile-link:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
    }

    /* Settings Section */
    .profile-settings {
        max-width: 600px;
        margin: 0 auto;
    }

    .profile-settings-card {
        background: white;
        padding: 25px;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }

    .profile-settings-card h3 {
        font-size: 18px;
        font-weight: 700;
        color: #1a202c;
        margin-bottom: 15px;
    }

    .profile-settings-btn {
        display: block;
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        text-align: center;
        text-decoration: none;
        transition: all 0.3s ease;
        margin-bottom: 10px;
    }

    .profile-settings-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
    }

    /* Responsive */
    @@media (max-width: 768px) {
        .profile-hero {
            height: 200px;
            border-radius: 0;
        }

        .profile-avatar-section {
            padding: 0 20px;
            margin-top: -60px;
        }

        .profile-avatar-wrapper,
        .profile-avatar {
            width: 120px;
            height: 120px;
        }

        .profile-avatar {
            font-size: 48px;
        }

        .profile-name {
            font-size: 24px;
        }

        .profile-stats {
            gap: 15px;
        }

        .profile-stat {
            min-width: 100px;
            padding: 12px 20px;
        }

        .profile-tabs {
            padding: 0 20px;
            overflow-x: auto;
        }

        .profile-tab {
            padding: 12px 20px;
            font-size: 14px;
        }

        .profile-tab-content {
            padding: 0 20px 40px;
        }

        .profile-posts-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="profile-container">
    <!-- Hero Header -->
    <div class="profile-hero" id="profileCover" style="@(!string.IsNullOrEmpty(Model.CoverImageUrl) ? $"background: url('{Model.CoverImageUrl}') center/cover no-repeat;" : "")">
        @if (ViewBag.IsOwnProfile == true)
        {
            <div class="cover-controls" style="position: absolute; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 10;">
                <label for="coverUpload" class="btn btn-light btn-sm shadow-sm" style="cursor: pointer; border-radius: 8px; font-weight: 600; display: flex; align-items: center; gap: 5px;">
                    üì∑ <span class="d-none d-md-inline">Changer couverture</span>
                </label>
                <input type="file" id="coverUpload" accept="image/*" style="display: none;" />
                
                @if (!string.IsNullOrEmpty(Model.CoverImageUrl))
                {
                    <button id="btnRemoveCover" class="btn btn-danger btn-sm shadow-sm" style="border-radius: 8px; display: flex; align-items: center; gap: 5px;">
                        üóëÔ∏è <span class="d-none d-md-inline">Supprimer</span>
                    </button>
                }
            </div>
            
            <!-- Hidden AntiForgery Token for AJAX -->
            @Html.AntiForgeryToken()
        }
        
        @if (ViewBag.IsOwnProfile == true)
        {
             <!-- Existing Edit Profile Button (Moved/Adjusted if needed, but keeping for now) -->
             <!-- It was absolute positioned top-right. -->
        }
    </div>

    <!-- Avatar & Info Section -->
    <div class="profile-avatar-section">
        <div class="profile-avatar-wrapper">
            @if (!string.IsNullOrEmpty(Model.User.ProfilePictureUrl))
            {
                <img src="@Url.Content(Model.User.ProfilePictureUrl)" alt="@userName" class="profile-avatar" />
            }
            else
            {
                <div class="profile-avatar">@initial</div>
            }
        </div>

        <div class="profile-info">
            <h1 class="profile-name">@userName</h1>
            <p class="profile-username">@@@userName</p>
            <p class="profile-bio">
                D√©veloppeur passionn√© | Membre de la communaut√© BlogAura
            </p>
        </div>

        <!-- Stats -->
        <div class="profile-stats">
            <div class="profile-stat">
                <div class="profile-stat-value">@postsCount</div>
                <div class="profile-stat-label">Posts</div>
            </div>
            <div class="profile-stat">
                <div class="profile-stat-value">
                    <a asp-controller="Users" asp-action="Followers" asp-route-userId="@Model.User.Id" style="text-decoration:none;color:inherit;">
                        @Model.FollowersCount
                    </a>
                </div>
                <div class="profile-stat-label">Abonn√©s</div>
            </div>
            <div class="profile-stat">
                <div class="profile-stat-value">
                    <a asp-controller="Users" asp-action="Following" asp-route-userId="@Model.User.Id" style="text-decoration:none;color:inherit;">
                        @Model.FollowingCount
                    </a>
                </div>
                <div class="profile-stat-label">Abonnements</div>
            </div>
            <div class="profile-stat">
                <div class="profile-stat-value">@joinDate</div>
                <div class="profile-stat-label">Membre depuis</div>
            </div>
        </div>

        <!-- Follow/Unfollow Button -->
        @if (ViewBag.IsOwnProfile == false)
        {
            <div class="text-center mt-3">
                @if (Model.IsFollowing)
                {
                    <form asp-controller="Users" asp-action="Unfollow" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="userId" value="@Model.User.Id" />
                        <button type="submit" class="btn btn-outline-secondary" style="border-radius: 10px; padding: 10px 30px; font-weight: 600;">
                            ‚úì Abonn√©
                        </button>
                    </form>
                }
                else
                {
                    <form asp-controller="Users" asp-action="Follow" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="userId" value="@Model.User.Id" />
                        <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 10px; padding: 10px 30px; font-weight: 600;">
                            + Suivre
                        </button>
                    </form>
                }
            </div>
        }
    </div>

    @{
        var nextContents = ViewBag.NextScheduledContents as IEnumerable<BLOGAURA.Models.Content.ContentCalendarItem>;
    }
    @if (nextContents != null && nextContents.Any())
    {
        <div class="card mb-4 mx-4">
            <div class="card-header">üóìÔ∏è Prochains contenus planifi√©s (√©diteur)</div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    @foreach (var it in nextContents)
                    {
                        <li class="mb-2">
                            <strong>@it.PlannedPublishDate.ToString("yyyy-MM-dd")</strong> ‚Äî @it.ContentType ‚Äî @it.Title
                            @if (it.PostId.HasValue)
                            {
                                <a asp-controller="Posts" asp-action="Details" asp-route-id="@it.PostId" class="ms-2">Voir</a>
                            }
                        </li>
                    }
                </ul>
            </div>
        </div>
    }

    <!-- Tabs -->
    <ul class="nav nav-tabs border-0 profile-tabs">
        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-posts">Posts</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-replies">Replies</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-reposts">Reposts</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-reels">Reels</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-likes">Likes</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-about">√Ä propos</button>
        </li>
    </ul>

    <div class="tab-content mt-3">
        <div class="tab-pane fade show active" id="tab-posts">
            <div class="profile-posts-grid">
                @if (Model.Posts != null && Model.Posts.Any())
                {
                    {
                        var currentUserIdStr = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
                        var isAdmin = User.IsInRole("Admin");
                        foreach (var post in Model.Posts)
                        {
                            var canEdit = isAdmin || (!string.IsNullOrEmpty(currentUserIdStr) && int.TryParse(currentUserIdStr, out var uid) && uid == post.UserId);
                            var card = new BLOGAURA.Models.Posts.PostCardViewModel {
                                Id = post.Id,
                                AuthorId = post.UserId.ToString(),
                                AuthorName = post.User?.DisplayName ?? post.User?.UserName ?? "Utilisateur",
                                AuthorPhotoUrl = post.User?.ProfilePictureUrl ?? string.Empty,
                                CreatedAtFormatted = post.CreatedAt.ToLocalTime().ToString("g"),
                                CanEditOrDelete = canEdit,
                                CanDelete = canEdit,
                                Post = post
                            };
                            @await Html.PartialAsync("~/Views/Posts/_PostCard.cshtml", card)
                        }
                    }
                }
                else
                {
                    <div class="text-center py-5">
                        <p class="text-muted" style="font-size: 18px;">Aucun post pour le moment.</p>
                    </div>
                }
            </div>
        </div>

        <div class="tab-pane fade" id="tab-replies">
            <div class="profile-posts-grid">
                @if (Model.Replies != null && Model.Replies.Any())
                {
                    {
                        var currentUserIdStr = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
                        var isAdmin = User.IsInRole("Admin");
                        foreach (var post in Model.Replies)
                        {
                            var canEdit = isAdmin || (!string.IsNullOrEmpty(currentUserIdStr) && int.TryParse(currentUserIdStr, out var uid) && uid == post.UserId);
                            var card = new BLOGAURA.Models.Posts.PostCardViewModel {
                                Id = post.Id,
                                AuthorId = post.UserId.ToString(),
                                AuthorName = post.User?.DisplayName ?? post.User?.UserName ?? "Utilisateur",
                                AuthorPhotoUrl = post.User?.ProfilePictureUrl ?? string.Empty,
                                CreatedAtFormatted = post.CreatedAt.ToLocalTime().ToString("g"),
                                CanEditOrDelete = canEdit,
                                CanDelete = canEdit,
                                Post = post
                            };
                            ViewData["ContextLabel"] = "R√©ponse";
                            @await Html.PartialAsync("~/Views/Posts/_PostCard.cshtml", card)
                            ViewData["ContextLabel"] = null;
                        }
                    }
                }
                else
                {
                    <div class="text-center py-5">
                        <p class="text-muted" style="font-size: 18px;">Aucune r√©ponse pour le moment.</p>
                    </div>
                }
            </div>
        </div>

        <div class="tab-pane fade" id="tab-reposts">
            <div class="profile-posts-grid">
                @if (Model.Reposts != null && Model.Reposts.Any())
                {
                    {
                        var currentUserIdStr = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
                        var isAdmin = User.IsInRole("Admin");
                        foreach (var post in Model.Reposts)
                        {
                            var canEdit = isAdmin || (!string.IsNullOrEmpty(currentUserIdStr) && int.TryParse(currentUserIdStr, out var uid) && uid == post.UserId);
                            var card = new BLOGAURA.Models.Posts.PostCardViewModel {
                                Id = post.Id,
                                AuthorId = post.UserId.ToString(),
                                AuthorName = post.User?.DisplayName ?? post.User?.UserName ?? "Utilisateur",
                                AuthorPhotoUrl = post.User?.ProfilePictureUrl ?? string.Empty,
                                CreatedAtFormatted = post.CreatedAt.ToLocalTime().ToString("g"),
                                CanEditOrDelete = canEdit,
                                CanDelete = canEdit,
                                Post = post
                            };
                            ViewData["ContextLabel"] = "Repost";
                            @await Html.PartialAsync("~/Views/Posts/_PostCard.cshtml", card)
                            ViewData["ContextLabel"] = null;
                        }
                    }
                }
                else
                {
                    <div class="text-center py-5">
                        <p class="text-muted" style="font-size: 18px;">Aucun repost pour le moment.</p>
                    </div>
                }
            </div>
        </div>

        <div class="tab-pane fade" id="tab-reels">
            @if (Model.Reels != null && Model.Reels.Any())
            {
                var currentUserIdStr = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
                var currentUserIdInt = 0;
                if (!string.IsNullOrEmpty(currentUserIdStr)) int.TryParse(currentUserIdStr, out currentUserIdInt);
                foreach (var r in Model.Reels)
                {
                    var vm = new BLOGAURA.Models.Reels.ReelViewModel
                    {
                        Id = r.Id,
                        UserId = r.UserId.ToString(),
                        UserName = r.User?.DisplayName ?? r.User?.UserName ?? "Utilisateur",
                        UserPhotoUrl = r.User?.ProfilePictureUrl ?? string.Empty,
                        Caption = r.Caption,
                        VideoPath = r.VideoPath,
                        CreatedAtFormatted = r.CreatedAt.ToLocalTime().ToString("g"),
                        LikesCount = r.Likes?.Count ?? 0,
                        CommentsCount = r.Comments?.Count ?? 0,
                        IsLikedByCurrentUser = r.Likes?.Any(l => l.UserId == currentUserIdInt) ?? false,
                        EventPostId = r.EventPostId,
                        EventTitle = r.EventPost?.Title ?? string.Empty,
                        Category = r.Category
                    };
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <a asp-controller="Home" asp-action="Profile" asp-route-userId="@vm.UserId">
                                    @if (!string.IsNullOrEmpty(vm.UserPhotoUrl))
                                    {
                                        <img src="@Url.Content(vm.UserPhotoUrl)" class="rounded-circle me-2" style="width:40px;height:40px;object-fit:cover;" />
                                    }
                                    else
                                    {
                                        <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center me-2" style="width:40px;height:40px;">@vm.UserName?.FirstOrDefault()</div>
                                    }
                                </a>
                                <div>
                                    <a asp-controller="Home" asp-action="Profile" asp-route-userId="@vm.UserId" class="fw-bold text-decoration-none text-dark">@vm.UserName</a>
                                    <div class="small text-muted">@vm.CreatedAtFormatted</div>
                                </div>
                            </div>

                            <div class="mb-2">
                                <video src="@Url.Content(vm.VideoPath)" controls playsinline style="width:100%;max-height:70vh;object-fit:cover;border-radius:8px;"></video>
                            </div>

                            @if (!string.IsNullOrWhiteSpace(vm.Caption))
                            {
                                <div class="mb-2">@vm.Caption</div>
                            }
                            @if (vm.EventPostId.HasValue)
                            {
                                <div class="small"><a asp-controller="Posts" asp-action="Details" asp-route-id="@vm.EventPostId">Voir l'√©v√©nement: @vm.EventTitle</a></div>
                            }

                            <div class="d-flex align-items-center gap-3 mt-2">
                                <form asp-controller="Reels" asp-action="ToggleLike" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@vm.Id" />
                                    <button type="submit" class="btn btn-link p-0 @(vm.IsLikedByCurrentUser ? "text-danger" : "")">‚ù§ @vm.LikesCount</button>
                                </form>
                                <a href="#profile-reel-@vm.Id-comments" class="btn btn-link p-0">üí¨ @vm.CommentsCount</a>
                            </div>

                            <div id="profile-reel-@vm.Id-comments" class="mt-3">
                                <form asp-controller="Reels" asp-action="AddComment" method="post" class="mb-2">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="ReelId" value="@vm.Id" />
                                    <div class="input-group">
                                        <input type="text" name="Content" class="form-control" placeholder="Votre commentaire..." />
                                        <button type="submit" class="btn btn-outline-primary">Publier</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="text-center py-5">
                    <p class="text-muted" style="font-size: 18px;">Aucun reel pour le moment.</p>
                </div>
            }
        </div>

        <div class="tab-pane fade" id="tab-likes">
            <div class="profile-posts-grid">
                @if (Model.Likes != null && Model.Likes.Any())
                {
                    {
                        var currentUserIdStr = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
                        var isAdmin = User.IsInRole("Admin");
                        foreach (var post in Model.Likes)
                        {
                            var canEdit = isAdmin || (!string.IsNullOrEmpty(currentUserIdStr) && int.TryParse(currentUserIdStr, out var uid) && uid == post.UserId);
                            var card = new BLOGAURA.Models.Posts.PostCardViewModel {
                                Id = post.Id,
                                AuthorId = post.UserId.ToString(),
                                AuthorName = post.User?.DisplayName ?? post.User?.UserName ?? "Utilisateur",
                                AuthorPhotoUrl = post.User?.ProfilePictureUrl ?? string.Empty,
                                CreatedAtFormatted = post.CreatedAt.ToLocalTime().ToString("g"),
                                CanEditOrDelete = canEdit,
                                CanDelete = canEdit,
                                Post = post
                            };
                            ViewData["ContextLabel"] = "Aim√©";
                            @await Html.PartialAsync("~/Views/Posts/_PostCard.cshtml", card)
                            ViewData["ContextLabel"] = null;
                        }
                    }
                }
                else
                {
                    <div class="text-center py-5">
                        <p class="text-muted" style="font-size: 18px;">Aucun like pour le moment.</p>
                    </div>
                }
            </div>
        </div>

        <div class="tab-pane fade" id="tab-about">
            <div class="profile-about">
            <!-- About Me Section -->
            <div class="profile-about-section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>üìù √Ä propos</h3>
                    @if (ViewBag.IsOwnProfile == true)
                    {
                        <a asp-controller="Profile" asp-action="Edit" class="btn btn-sm btn-outline-primary">
                            ‚úèÔ∏è Modifier le profil
                        </a>
                    }
                </div>

                <p style="color: #4a5568; line-height: 1.6; white-space: pre-wrap;">
                    @(!string.IsNullOrWhiteSpace(Model.User.About) ? Model.User.About : "Aucune description pour le moment.")
                </p>
            </div>

            <!-- Student Journey Section -->
            <div class="profile-about-section">
                <h3>üéì Parcours √©tudiant</h3>
                <ul style="list-style: none; padding-left: 0;">
                    <li style="margin-bottom: 8px;"><strong>Universit√© :</strong> @(Model.User.University ?? "Non renseign√©e")</li>
                    <li style="margin-bottom: 8px;"><strong>Niveau :</strong> @(Model.User.Grade ?? "Non renseign√©")</li>
                    <li style="margin-bottom: 8px;"><strong>Ville :</strong> @(Model.User.City ?? "Non renseign√©e")</li>
                    <li style="margin-bottom: 8px;"><strong>√Çge :</strong> @(Model.User.Age.HasValue ? Model.User.Age.Value.ToString() + " ans" : "Non renseign√©")</li>
                </ul>
            </div>

            <!-- Events & Interests Section -->
            <div class="profile-about-section">
                <h3>üéüÔ∏è √âv√©nements & Centres d'int√©r√™t</h3>
                <p style="color: #4a5568; margin-bottom: 10px;">
                    <strong>Types d'√©v√©nements pr√©f√©r√©s :</strong><br />
                    @(Model.User.FavoriteEventTypes ?? "Hackathons, conf√©rences, meetups tech...")
                </p>
                <p style="color: #4a5568;">
                    <strong>Hobbies :</strong><br />
                    @(Model.User.Hobbies ?? "Football, cybers√©curit√©, musique...")
                </p>
            </div>

            <!-- Campus & Cities Section (Event-oriented) -->
            @if (!string.IsNullOrWhiteSpace(Model.User.City) || !string.IsNullOrWhiteSpace(Model.User.University))
            {
                <div class="profile-about-section">
                    <h3>üìç Campus & Localisation</h3>
                    <p style="color: #4a5568;">
                        @if (!string.IsNullOrWhiteSpace(Model.User.University))
                        {
                            <text>√âtudie √† <strong>@Model.User.University</strong></text>
                            if (!string.IsNullOrWhiteSpace(Model.User.City))
                            {
                                <text> √† <strong>@Model.User.City</strong></text>
                            }
                            <text>.</text>
                        }
                        else if (!string.IsNullOrWhiteSpace(Model.User.City))
                        {
                            <text>Bas√©(e) √† <strong>@Model.User.City</strong>.</text>
                        }
                    </p>
                    @if (!string.IsNullOrWhiteSpace(Model.User.FavoriteEventTypes))
                    {
                        <p style="color: #667eea; font-weight: 600;">
                            üî• Cherche des √©v√©nements : @Model.User.FavoriteEventTypes
                        </p>
                    }
                </div>
            }

            <!-- Currently Learning Section -->
            <div class="profile-about-section">
                <h3>üìö Actuellement en apprentissage</h3>
                <p style="color: #4a5568; line-height: 1.6;">
                    @(Model.User.LearningNow ?? "ASP.NET Core Identity, Design Patterns, Clean Architecture")
                </p>
            </div>

            <!-- Social Links Section -->
            <div class="profile-about-section">
                <h3>üîó Liens</h3>
                <div class="profile-links">
                    @if (!string.IsNullOrWhiteSpace(Model.User.GithubUrl))
                    {
                        <a href="@Model.User.GithubUrl" target="_blank" class="profile-link">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                            GitHub
                        </a>
                    }
                    @if (!string.IsNullOrWhiteSpace(Model.User.LinkedinUrl))
                    {
                        <a href="@Model.User.LinkedinUrl" target="_blank" class="profile-link">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                            LinkedIn
                        </a>
                    }
                    @if (!string.IsNullOrWhiteSpace(Model.User.PortfolioUrl))
                    {
                        <a href="@Model.User.PortfolioUrl" target="_blank" class="profile-link">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm0 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0 3c-3.866 0-7 3.134-7 7s3.134 7 7 7 7-3.134 7-7-3.134-7-7-7zm0 2c2.761 0 5 2.239 5 5s-2.239 5-5 5-5-2.239-5-5 2.239-5 5-5z"/></svg>
                            Portfolio
                        </a>
                    }
                    @if (string.IsNullOrWhiteSpace(Model.User.GithubUrl) && string.IsNullOrWhiteSpace(Model.User.LinkedinUrl) && string.IsNullOrWhiteSpace(Model.User.PortfolioUrl))
                    {
                        <p class="text-muted">Aucun lien ajout√©</p>
                    }
                </div>
            </div>

            <div class="profile-about-section">
                <h3>üìß Contact</h3>
                <p style="color: #4a5568;">
                    <strong>Email:</strong> @email
                </p>
            </div>
        </div>

    </div>

@section Scripts {
    <script>
    function toggleAboutEdit() {
        const displayDiv = document.getElementById('about-display');
        const editDiv = document.getElementById('about-edit');
        const editBtn = document.getElementById('edit-about-btn');

        if (displayDiv.style.display === 'none') {
            // Switch back to display mode
            displayDiv.style.display = 'block';
            editDiv.style.display = 'none';
            editBtn.innerHTML = '‚úèÔ∏è Modifier';
        } else {
            // Switch to edit mode
            displayDiv.style.display = 'none';
            editDiv.style.display = 'block';
            editBtn.innerHTML = '‚ùå Annuler';
        }
    }

    $(document).ready(function () {
        // Upload Cover
        $('#coverUpload').change(function () {
            var file = this.files[0];
            if (!file) return;

            // Validate size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert("L'image est trop volumineuse (max 5 Mo).");
                return;
            }

            var formData = new FormData();
            formData.append('coverImage', file);
            // Get token from the hidden input generated by @Html.AntiForgeryToken()
            var token = $('input[name="__RequestVerificationToken"]').val();
            formData.append('__RequestVerificationToken', token);

            $.ajax({
                url: '@Url.Action("UpdateCover", "Home")',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        $('#profileCover').css('background', 'url(' + response.newCoverUrl + ') center/cover no-repeat');
                        
                        // Dynamically add remove button if it doesn't exist
                        if ($('#btnRemoveCover').length === 0) {
                            var removeBtn = $('<button id="btnRemoveCover" class="btn btn-danger btn-sm shadow-sm" style="border-radius: 8px; display: flex; align-items: center; gap: 5px;">üóëÔ∏è <span class="d-none d-md-inline">Supprimer</span></button>');
                            $('.cover-controls').append(removeBtn);
                        }
                    } else {
                        alert(response.message || "Erreur lors du t√©l√©chargement.");
                    }
                },
                error: function () {
                    alert("Une erreur est survenue lors du t√©l√©chargement.");
                }
            });
        });

        // Remove Cover
        $(document).on('click', '#btnRemoveCover', function () {
            if (!confirm("Voulez-vous vraiment supprimer votre photo de couverture ?")) return;

            var token = $('input[name="__RequestVerificationToken"]').val();

            $.ajax({
                url: '@Url.Action("DeleteCover", "Home")',
                type: 'POST',
                data: {
                    '__RequestVerificationToken': token
                },
                success: function (response) {
                    if (response.success) {
                        $('#profileCover').css('background', ''); // Reset to default CSS
                        $('#btnRemoveCover').remove();
                    } else {
                        alert(response.message || "Erreur lors de la suppression.");
                    }
                },
                error: function () {
                    alert("Une erreur est survenue lors de la suppression.");
                }
            });
        });
    });
    </script>
}
